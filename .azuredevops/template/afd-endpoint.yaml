parameters:
  - name: deployFromFeature
    displayName: "Deploy from Feature Branch"
    type: boolean
    default: false
  - name: program
    type: string
  - name: service
    type: string

resources:
  repositories:
    - repository: ADPPipelineCommon
      name: DEFRA/adp-pipeline-common
      endpoint: DEFRA
      type: github
      ref: pp/ado-pipeline-common

extends:
  template: /pipelines/common-infra-deploy.yaml@ADPPipelineCommon
  parameters:
    projectName: $(projectName)
    deployFromFeature: ${{ parameters.deployFromFeature }}
    filePathsForTransform: |
      infra/bicep-generic/cdn/afd-endpoint.bicep
    groupedDeployments:
      - name: application_endpoint
        deployments:
          - name: afd-cluster.main
            path: infra/bicep-generic/cdn
            parameterFilePath: infra/services/${{ parameters.program }}/${{ parameters.service }}
            resourceGroupName: $(cdnResourceGroup)